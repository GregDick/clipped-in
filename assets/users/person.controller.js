'use strict';

angular.module('clippedIn').controller('PersonCtrl', function (Profile, $routeParams, FB_URL, $filter, $scope, $rootScope, $location, Outside, SweetAlert) {
  //=====================THIS CONTROLLER IS FOR VIEWING SOMEONE ELSE'S PROFILE===================
  var main = this;

  //call popover toggle function
  main.toggleTop = function () {
    $('.topPop').popover('toggle');
  };
  main.toggleLead = function () {
    $('.leadPop').popover('toggle');
  };
  //gets user information
  var fb = new Firebase(FB_URL);
  var authData = fb.getAuth();

  //gets id of profile that is being viewed
  main.id = $routeParams.id;

  //if this is your own profile redirect to #/profile
  if (authData.uid === main.id) {
    $location.path('/profile');
  }

  Profile.getProfile(main.id, function (profileObj) {
    main.profileObj = profileObj;
    //set topRope and lead as booleans
    main.topRope = $filter('lowercase')(profileObj.topRope) === 'yes' ? true : false;
    main.lead = $filter('lowercase')(profileObj.lead) === 'yes' ? true : false;
    //set belay string
    if (main.topRope && main.lead) {
      main.belay = ' can top-rope AND lead belay';
    } else if (main.topRope && !main.lead) {
      main.belay = ' can top-rope belay but doesn\'t know how to lead belay yet...';
    } else if (!main.topRope && main.lead) {
      main.belay = ' can lead belay but doesn\'t know how to top-rope belay yet...';
    } else {
      main.belay = ' doesn\'t know how to belay yet...';
    }
  });

  checkTopRope();
  checkLead();

  main.endorseTopRope = function () {
    Profile.addTopRope(main.id, authData.uid, function () {
      checkTopRope();
      SweetAlert.swal({
        title: '+1 Top-Rope Belay!',
        type: 'success',
        showConfirmButton: false,
        timer: 1500
      });
    });
  };
  main.endorseLead = function () {
    Profile.addLead(main.id, authData.uid, function () {
      checkLead();
      SweetAlert.swal({
        title: '+1 Lead Belay!',
        type: 'success',
        showConfirmButton: false,
        timer: 1500
      });
    });
  };

  function checkTopRope() {
    Profile.getTopRope(main.id, function (res) {
      main.topRopeNames = [];
      //makes sure you can't endorse twice and sets popover array
      for (var id in res) {
        if (res[id] === authData.uid) {
          main.disableTopRope = true;
        }
        Profile.getProfile(res[id], function (profileObj) {
          main.topRopeNames.push(profileObj.name);
          console.log(profileObj);
          //lists first + number of endorsed
          if (main.topRopeNames.length > 2) {
            main.topRopePeople = main.topRopeNames[0] + ' and ' + (main.topRopeNames.length - 1) + ' other people think ';
          } else if (main.topRopeNames.length === 2) {
            main.topRopePeople = main.topRopeNames[0] + ' and 1 other person think ';
          } else {
            main.topRopePeople = main.topRopeNames[0] + ' thinks ';
          }
        });
      }
    });
  };

  function checkLead() {
    Profile.getLead(main.id, function (res) {
      main.leadNames = [];
      //makes sure you can't endorse twice and sets popover array
      for (var id in res) {
        if (res[id] === authData.uid) {
          main.disableLead = true;
        }
        Profile.getProfile(res[id], function (profileObj) {
          main.leadNames.push(profileObj.name);
          //lists whoever endorsed
          if (main.leadNames.length > 2) {
            main.leadPeople = main.leadNames[0] + ' and ' + (main.leadNames.length - 1) + ' other people think ';
          } else if (main.leadNames.length === 2) {
            main.leadPeople = main.leadNames[0] + ' and 1 other person think ';
          } else {
            main.leadPeople = main.leadNames[0] + ' thinks ';
          }
        });
      }
    });
  };

  //get trip list to see if profile should link to trip
  Outside.getTrips(function (trips) {
    main.trips = trips;
    for (var id in trips) {
      if (main.id === id) {
        main.tripLink = '#/trip/' + id;
      }
    }
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9hc3NldHMvdXNlcnMvcGVyc29uLmNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxPQUFPLENBQ0osTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUNuQixVQUFVLENBQUMsWUFBWSxFQUFFLFVBQVMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUM7O0FBRTVILE1BQUksSUFBSSxHQUFHLElBQUksQ0FBQzs7O0FBS2hCLE1BQUksQ0FBQyxTQUFTLEdBQUcsWUFBVztBQUMxQixLQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0dBQ2hDLENBQUE7QUFDRCxNQUFJLENBQUMsVUFBVSxHQUFHLFlBQVc7QUFDM0IsS0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztHQUNqQyxDQUFBOztBQUVELE1BQUksRUFBRSxHQUFHLElBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO0FBQzlCLE1BQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxPQUFPLEVBQUUsQ0FBQzs7O0FBRzVCLE1BQUksQ0FBQyxFQUFFLEdBQUcsWUFBWSxDQUFDLEVBQUUsQ0FBQzs7O0FBRzFCLE1BQUcsUUFBUSxDQUFDLEdBQUcsS0FBSyxJQUFJLENBQUMsRUFBRSxFQUFDO0FBQzFCLGFBQVMsQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLENBQUM7R0FDNUI7O0FBRUQsU0FBTyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLFVBQVMsVUFBVSxFQUFDO0FBQzlDLFFBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDOztBQUU3QixRQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLEtBQUssS0FBSyxHQUFHLElBQUksR0FBRyxLQUFLLENBQUM7QUFDakYsUUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssR0FBRyxJQUFJLEdBQUcsS0FBSyxDQUFDOztBQUV6RSxRQUFHLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBQztBQUMzQixVQUFJLENBQUMsS0FBSyxHQUFHLDhCQUE4QixDQUFDO0tBQzdDLE1BQUssSUFBRyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBQztBQUNsQyxVQUFJLENBQUMsS0FBSyxHQUFHLGdFQUErRCxDQUFDO0tBQzlFLE1BQUssSUFBRyxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLElBQUksRUFBQztBQUNsQyxVQUFJLENBQUMsS0FBSyxHQUFHLGdFQUErRCxDQUFDO0tBQzlFLE1BQUk7QUFDSCxVQUFJLENBQUMsS0FBSyxHQUFHLG9DQUFtQyxDQUFDO0tBQ2xEO0dBQ0osQ0FBQyxDQUFBOztBQUVGLGNBQVksRUFBRSxDQUFDO0FBQ2YsV0FBUyxFQUFFLENBQUM7O0FBRVosTUFBSSxDQUFDLGNBQWMsR0FBRyxZQUFVO0FBQzlCLFdBQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxRQUFRLENBQUMsR0FBRyxFQUFFLFlBQVU7QUFDbEQsa0JBQVksRUFBRSxDQUFDO0FBQ2YsZ0JBQVUsQ0FBQyxJQUFJLENBQUM7QUFDZCxhQUFLLEVBQUUsb0JBQW9CO0FBQzNCLFlBQUksRUFBRSxTQUFTO0FBQ2YseUJBQWlCLEVBQUUsS0FBSztBQUN4QixhQUFLLEVBQUUsSUFBSTtPQUNaLENBQUMsQ0FBQztLQUNKLENBQUMsQ0FBQTtHQUNILENBQUE7QUFDRCxNQUFJLENBQUMsV0FBVyxHQUFHLFlBQVU7QUFDM0IsV0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLFFBQVEsQ0FBQyxHQUFHLEVBQUUsWUFBVTtBQUMvQyxlQUFTLEVBQUUsQ0FBQztBQUNaLGdCQUFVLENBQUMsSUFBSSxDQUFDO0FBQ2QsYUFBSyxFQUFFLGdCQUFnQjtBQUN2QixZQUFJLEVBQUUsU0FBUztBQUNmLHlCQUFpQixFQUFFLEtBQUs7QUFDeEIsYUFBSyxFQUFFLElBQUk7T0FDWixDQUFDLENBQUM7S0FDSixDQUFDLENBQUE7R0FDSCxDQUFBOztBQUVELFdBQVMsWUFBWSxHQUFFO0FBQ3JCLFdBQU8sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxVQUFTLEdBQUcsRUFBQztBQUN2QyxVQUFJLENBQUMsWUFBWSxHQUFHLEVBQUUsQ0FBQzs7QUFFdkIsV0FBSSxJQUFJLEVBQUUsSUFBSSxHQUFHLEVBQUM7QUFDaEIsWUFBRyxHQUFHLENBQUMsRUFBRSxDQUFDLEtBQUssUUFBUSxDQUFDLEdBQUcsRUFBQztBQUMxQixjQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztTQUM1QjtBQUNELGVBQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLFVBQVMsVUFBVSxFQUFDO0FBQzlDLGNBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUN4QyxpQkFBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQzs7QUFFeEIsY0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUM7QUFDOUIsZ0JBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBLEFBQUMsR0FBRSxzQkFBc0IsQ0FBQztXQUM5RyxNQUFLLElBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFDO0FBQ3RDLGdCQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsNEJBQTRCLENBQUM7V0FDMUUsTUFBSTtBQUNILGdCQUFJLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDO1dBQ3hEO1NBQ0YsQ0FBQyxDQUFBO09BQ0g7S0FDRixDQUFDLENBQUE7R0FDSCxDQUFDOztBQUVGLFdBQVMsU0FBUyxHQUFFO0FBQ2xCLFdBQU8sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxVQUFTLEdBQUcsRUFBQztBQUNwQyxVQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQzs7QUFFcEIsV0FBSSxJQUFJLEVBQUUsSUFBSSxHQUFHLEVBQUM7QUFDaEIsWUFBRyxHQUFHLENBQUMsRUFBRSxDQUFDLEtBQUssUUFBUSxDQUFDLEdBQUcsRUFBQztBQUMxQixjQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQztTQUN6QjtBQUNELGVBQU8sQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxFQUFFLFVBQVMsVUFBVSxFQUFDO0FBQzlDLGNBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQzs7QUFFckMsY0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUM7QUFDM0IsZ0JBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsR0FBRyxPQUFPLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFBLEFBQUMsR0FBRSxzQkFBc0IsQ0FBQztXQUNyRyxNQUFLLElBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFDO0FBQ25DLGdCQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsNEJBQTRCLENBQUM7V0FDcEUsTUFDRztBQUNGLGdCQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsVUFBVSxDQUFDO1dBQ2xEO1NBQ0YsQ0FBQyxDQUFBO09BQ0g7S0FDRixDQUFDLENBQUE7R0FDSCxDQUFDOzs7QUFHRixTQUFPLENBQUMsUUFBUSxDQUFDLFVBQVMsS0FBSyxFQUFDO0FBQzlCLFFBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0FBQ25CLFNBQUksSUFBSSxFQUFFLElBQUksS0FBSyxFQUFDO0FBQ2xCLFVBQUcsSUFBSSxDQUFDLEVBQUUsS0FBRyxFQUFFLEVBQUM7QUFDZCxZQUFJLENBQUMsUUFBUSxHQUFHLFNBQVMsR0FBQyxFQUFFLENBQUM7T0FDOUI7S0FDRjtHQUNGLENBQUMsQ0FBQztDQUVKLENBQUMsQ0FBQSIsImZpbGUiOiJzcmMvYXNzZXRzL3VzZXJzL3BlcnNvbi5jb250cm9sbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhclxuICAubW9kdWxlKCdjbGlwcGVkSW4nKVxuICAuY29udHJvbGxlcignUGVyc29uQ3RybCcsIGZ1bmN0aW9uKFByb2ZpbGUsICRyb3V0ZVBhcmFtcywgRkJfVVJMLCAkZmlsdGVyLCAkc2NvcGUsICRyb290U2NvcGUsICRsb2NhdGlvbiwgT3V0c2lkZSwgU3dlZXRBbGVydCl7XG4vLz09PT09PT09PT09PT09PT09PT09PVRISVMgQ09OVFJPTExFUiBJUyBGT1IgVklFV0lORyBTT01FT05FIEVMU0UnUyBQUk9GSUxFPT09PT09PT09PT09PT09PT09PVxuICAgIHZhciBtYWluID0gdGhpcztcblxuXG5cbiAgICAvL2NhbGwgcG9wb3ZlciB0b2dnbGUgZnVuY3Rpb25cbiAgICBtYWluLnRvZ2dsZVRvcCA9IGZ1bmN0aW9uICgpe1xuICAgICAgJCgnLnRvcFBvcCcpLnBvcG92ZXIoJ3RvZ2dsZScpO1xuICAgIH1cbiAgICBtYWluLnRvZ2dsZUxlYWQgPSBmdW5jdGlvbiAoKXtcbiAgICAgICQoJy5sZWFkUG9wJykucG9wb3ZlcigndG9nZ2xlJyk7XG4gICAgfVxuICAgIC8vZ2V0cyB1c2VyIGluZm9ybWF0aW9uXG4gICAgdmFyIGZiID0gbmV3IEZpcmViYXNlKEZCX1VSTCk7XG4gICAgdmFyIGF1dGhEYXRhID0gZmIuZ2V0QXV0aCgpO1xuXG4gICAgLy9nZXRzIGlkIG9mIHByb2ZpbGUgdGhhdCBpcyBiZWluZyB2aWV3ZWRcbiAgICBtYWluLmlkID0gJHJvdXRlUGFyYW1zLmlkO1xuXG4gICAgLy9pZiB0aGlzIGlzIHlvdXIgb3duIHByb2ZpbGUgcmVkaXJlY3QgdG8gIy9wcm9maWxlXG4gICAgaWYoYXV0aERhdGEudWlkID09PSBtYWluLmlkKXtcbiAgICAgICRsb2NhdGlvbi5wYXRoKCcvcHJvZmlsZScpO1xuICAgIH1cblxuICAgIFByb2ZpbGUuZ2V0UHJvZmlsZShtYWluLmlkLCBmdW5jdGlvbihwcm9maWxlT2JqKXtcbiAgICAgIG1haW4ucHJvZmlsZU9iaiA9IHByb2ZpbGVPYmo7XG4gICAgICAvL3NldCB0b3BSb3BlIGFuZCBsZWFkIGFzIGJvb2xlYW5zXG4gICAgICBtYWluLnRvcFJvcGUgPSAkZmlsdGVyKCdsb3dlcmNhc2UnKShwcm9maWxlT2JqLnRvcFJvcGUpID09PSAneWVzJyA/IHRydWUgOiBmYWxzZTtcbiAgICAgIG1haW4ubGVhZCA9ICRmaWx0ZXIoJ2xvd2VyY2FzZScpKHByb2ZpbGVPYmoubGVhZCkgPT09ICd5ZXMnID8gdHJ1ZSA6IGZhbHNlO1xuICAgICAgLy9zZXQgYmVsYXkgc3RyaW5nXG4gICAgICAgIGlmKG1haW4udG9wUm9wZSAmJiBtYWluLmxlYWQpe1xuICAgICAgICAgIG1haW4uYmVsYXkgPSAnIGNhbiB0b3Atcm9wZSBBTkQgbGVhZCBiZWxheSc7XG4gICAgICAgIH1lbHNlIGlmKG1haW4udG9wUm9wZSAmJiAhbWFpbi5sZWFkKXtcbiAgICAgICAgICBtYWluLmJlbGF5ID0gXCIgY2FuIHRvcC1yb3BlIGJlbGF5IGJ1dCBkb2Vzbid0IGtub3cgaG93IHRvIGxlYWQgYmVsYXkgeWV0Li4uXCI7XG4gICAgICAgIH1lbHNlIGlmKCFtYWluLnRvcFJvcGUgJiYgbWFpbi5sZWFkKXtcbiAgICAgICAgICBtYWluLmJlbGF5ID0gXCIgY2FuIGxlYWQgYmVsYXkgYnV0IGRvZXNuJ3Qga25vdyBob3cgdG8gdG9wLXJvcGUgYmVsYXkgeWV0Li4uXCI7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgIG1haW4uYmVsYXkgPSBcIiBkb2Vzbid0IGtub3cgaG93IHRvIGJlbGF5IHlldC4uLlwiO1xuICAgICAgICB9XG4gICAgfSlcblxuICAgIGNoZWNrVG9wUm9wZSgpO1xuICAgIGNoZWNrTGVhZCgpO1xuXG4gICAgbWFpbi5lbmRvcnNlVG9wUm9wZSA9IGZ1bmN0aW9uKCl7XG4gICAgICBQcm9maWxlLmFkZFRvcFJvcGUobWFpbi5pZCwgYXV0aERhdGEudWlkLCBmdW5jdGlvbigpe1xuICAgICAgICBjaGVja1RvcFJvcGUoKTtcbiAgICAgICAgU3dlZXRBbGVydC5zd2FsKHtcbiAgICAgICAgICB0aXRsZTogJysxIFRvcC1Sb3BlIEJlbGF5IScsXG4gICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgICB0aW1lcjogMTUwMFxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgfVxuICAgIG1haW4uZW5kb3JzZUxlYWQgPSBmdW5jdGlvbigpe1xuICAgICAgUHJvZmlsZS5hZGRMZWFkKG1haW4uaWQsIGF1dGhEYXRhLnVpZCwgZnVuY3Rpb24oKXtcbiAgICAgICAgY2hlY2tMZWFkKCk7XG4gICAgICAgIFN3ZWV0QWxlcnQuc3dhbCh7XG4gICAgICAgICAgdGl0bGU6ICcrMSBMZWFkIEJlbGF5IScsXG4gICAgICAgICAgdHlwZTogJ3N1Y2Nlc3MnLFxuICAgICAgICAgIHNob3dDb25maXJtQnV0dG9uOiBmYWxzZSxcbiAgICAgICAgICB0aW1lcjogMTUwMFxuICAgICAgICB9KTtcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2hlY2tUb3BSb3BlKCl7XG4gICAgICBQcm9maWxlLmdldFRvcFJvcGUobWFpbi5pZCwgZnVuY3Rpb24ocmVzKXtcbiAgICAgICAgbWFpbi50b3BSb3BlTmFtZXMgPSBbXTtcbiAgICAgICAgLy9tYWtlcyBzdXJlIHlvdSBjYW4ndCBlbmRvcnNlIHR3aWNlIGFuZCBzZXRzIHBvcG92ZXIgYXJyYXlcbiAgICAgICAgZm9yKHZhciBpZCBpbiByZXMpe1xuICAgICAgICAgIGlmKHJlc1tpZF0gPT09IGF1dGhEYXRhLnVpZCl7XG4gICAgICAgICAgICBtYWluLmRpc2FibGVUb3BSb3BlID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgUHJvZmlsZS5nZXRQcm9maWxlKHJlc1tpZF0sIGZ1bmN0aW9uKHByb2ZpbGVPYmope1xuICAgICAgICAgICAgbWFpbi50b3BSb3BlTmFtZXMucHVzaChwcm9maWxlT2JqLm5hbWUpO1xuICAgICAgICAgICAgY29uc29sZS5sb2cocHJvZmlsZU9iaik7XG4gICAgICAgICAgICAvL2xpc3RzIGZpcnN0ICsgbnVtYmVyIG9mIGVuZG9yc2VkXG4gICAgICAgICAgICBpZihtYWluLnRvcFJvcGVOYW1lcy5sZW5ndGggPiAyKXtcbiAgICAgICAgICAgICAgbWFpbi50b3BSb3BlUGVvcGxlID0gbWFpbi50b3BSb3BlTmFtZXNbMF0gKyAnIGFuZCAnICsgKG1haW4udG9wUm9wZU5hbWVzLmxlbmd0aCAtIDEpICsnIG90aGVyIHBlb3BsZSB0aGluayAnO1xuICAgICAgICAgICAgfWVsc2UgaWYobWFpbi50b3BSb3BlTmFtZXMubGVuZ3RoID09PSAyKXtcbiAgICAgICAgICAgICAgbWFpbi50b3BSb3BlUGVvcGxlID0gbWFpbi50b3BSb3BlTmFtZXNbMF0gKyAnIGFuZCAxIG90aGVyIHBlcnNvbiB0aGluayAnO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgIG1haW4udG9wUm9wZVBlb3BsZSA9IG1haW4udG9wUm9wZU5hbWVzWzBdICsgJyB0aGlua3MgJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH07XG5cbiAgICBmdW5jdGlvbiBjaGVja0xlYWQoKXtcbiAgICAgIFByb2ZpbGUuZ2V0TGVhZChtYWluLmlkLCBmdW5jdGlvbihyZXMpe1xuICAgICAgICBtYWluLmxlYWROYW1lcyA9IFtdO1xuICAgICAgICAvL21ha2VzIHN1cmUgeW91IGNhbid0IGVuZG9yc2UgdHdpY2UgYW5kIHNldHMgcG9wb3ZlciBhcnJheVxuICAgICAgICBmb3IodmFyIGlkIGluIHJlcyl7XG4gICAgICAgICAgaWYocmVzW2lkXSA9PT0gYXV0aERhdGEudWlkKXtcbiAgICAgICAgICAgIG1haW4uZGlzYWJsZUxlYWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgICBQcm9maWxlLmdldFByb2ZpbGUocmVzW2lkXSwgZnVuY3Rpb24ocHJvZmlsZU9iail7XG4gICAgICAgICAgICBtYWluLmxlYWROYW1lcy5wdXNoKHByb2ZpbGVPYmoubmFtZSk7XG4gICAgICAgICAgICAvL2xpc3RzIHdob2V2ZXIgZW5kb3JzZWRcbiAgICAgICAgICAgIGlmKG1haW4ubGVhZE5hbWVzLmxlbmd0aCA+IDIpe1xuICAgICAgICAgICAgICBtYWluLmxlYWRQZW9wbGUgPSBtYWluLmxlYWROYW1lc1swXSArICcgYW5kICcgKyAobWFpbi5sZWFkTmFtZXMubGVuZ3RoIC0gMSkgKycgb3RoZXIgcGVvcGxlIHRoaW5rICc7XG4gICAgICAgICAgICB9ZWxzZSBpZihtYWluLmxlYWROYW1lcy5sZW5ndGggPT09IDIpe1xuICAgICAgICAgICAgICBtYWluLmxlYWRQZW9wbGUgPSBtYWluLmxlYWROYW1lc1swXSArICcgYW5kIDEgb3RoZXIgcGVyc29uIHRoaW5rICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICBtYWluLmxlYWRQZW9wbGUgPSBtYWluLmxlYWROYW1lc1swXSArICcgdGhpbmtzICc7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgICAgfSlcbiAgICB9O1xuXG4gICAgLy9nZXQgdHJpcCBsaXN0IHRvIHNlZSBpZiBwcm9maWxlIHNob3VsZCBsaW5rIHRvIHRyaXBcbiAgICBPdXRzaWRlLmdldFRyaXBzKGZ1bmN0aW9uKHRyaXBzKXtcbiAgICAgIG1haW4udHJpcHMgPSB0cmlwcztcbiAgICAgIGZvcih2YXIgaWQgaW4gdHJpcHMpe1xuICAgICAgICBpZihtYWluLmlkPT09aWQpe1xuICAgICAgICAgIG1haW4udHJpcExpbmsgPSAnIy90cmlwLycraWQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICB9KVxuIl19
